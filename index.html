<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Liberatory Weekly Planner</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
<style>
@media print {
    .no-print { display: none !important; }
    body { background: white !important; }
}
</style>
</head>
<body class="bg-gradient-to-br from-amber-50 to-green-50 min-h-screen">
<div id="app"></div>
<input type="file" id="fileInput" accept=".json" class="hidden">

<script>
const state = {
    showWelcome: true,
    plannerData: {},
    statusMessage: { text: '', type: '', show: false }
};

const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

function updateState(newState) {
    Object.assign(state, newState);
    render();
}

function getWeekOf() {
    const today = new Date();
    const day = today.getDay();
    const diff = today.getDate() - day + (day === 0 ? -6 : 1);
    const monday = new Date(today);
    monday.setDate(diff);
    return monday.toISOString().split('T')[0];
}

function showStatus(text, type='success') {
    state.statusMessage = { text, type, show: true };
    render();
    setTimeout(() => {
        state.statusMessage.show = false;
        render();
    }, 3000);
}

function downloadPlanner() {
    const data = { savedDate: new Date().toISOString(), weekOf: getWeekOf(), ...state.plannerData };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `liberatory-planner-${data.weekOf}.json`;
    link.click();
    URL.revokeObjectURL(url);
    showStatus('‚úì Your plan has been downloaded!');
}

function loadPlanner(file) {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const data = JSON.parse(e.target.result);
            state.plannerData = data;
            showStatus('‚úì Plan loaded successfully!');
        } catch {
            showStatus('‚úó Error loading file. Check file format.', 'error');
        }
    };
    reader.readAsText(file);
}

function clearPlanner() {
    if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
        state.plannerData = {};
        showStatus('‚úì All data cleared');
    }
}

function printPlanner() {
    window.print();
    showStatus('‚úì Print dialog opened - select "Save as PDF" to export');
}

function handleInputChange(field, value) {
    state.plannerData[field] = value;
}

function renderWelcome() {
    return `
        <div class="min-h-screen p-5 flex items-center justify-center">
            <div class="max-w-2xl bg-white rounded-xl shadow-2xl p-8 md:p-12 text-center">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-3">
                    Welcome to the<br/>Liberatory Weekly Planner
                </h1>
                <p class="text-xl text-green-800 font-medium mb-2">
                    Align Your Week with Clarity, Courage & Care
                </p>
                <p class="text-sm text-gray-600 italic mb-6">
                    Created exclusively for the Blueprints for Freedom community
                </p>
                <button id="beginBtn" class="w-full px-8 py-4 bg-gradient-to-r from-red-500 to-red-700 text-white font-bold text-lg rounded-lg uppercase tracking-wide hover:shadow-xl transition-all hover:-translate-y-1">
                    Begin Planning ‚Üí
                </button>
            </div>
        </div>
    `;
}

function renderPlanner() {
    const getValue = field => state.plannerData[field] || '';
    const todayIndex = new Date().getDay() === 0 ? 6 : new Date().getDay() - 1;

    return `
        ${state.statusMessage.show ? `
        <div class="no-print fixed top-5 right-5 px-6 py-4 rounded-lg text-white font-semibold shadow-lg z-50 ${state.statusMessage.type === 'success' ? 'bg-green-700' : 'bg-red-600'}">
            ${state.statusMessage.text}
        </div>` : ''}

        <div class="max-w-6xl mx-auto p-5">

            <!-- Header -->
            <header class="text-center mb-10 border-b-4 border-red-500 pb-5">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-2">Liberatory Weekly Planner</h1>
                <p class="text-lg text-green-800 font-medium tracking-wide">Align Your Week with Clarity, Courage & Care</p>
                <p class="text-sm text-gray-600 mt-2">Week of: <strong>${getWeekOf()}</strong></p>
            </header>

            <!-- Weekly Overview -->
            <section class="bg-white border-l-8 border-red-500 rounded-lg p-8 mb-10 shadow-lg">
                <h2 class="text-2xl font-bold text-red-600 mb-5 flex items-center gap-2"><span>‚óÜ</span> Weekly Overview</h2>
                <div class="grid md:grid-cols-2 gap-5">
                    ${['wordOfWeek','keyIntention','majorProject','letGo'].map(field => `
                        <div>
                            <label class="block font-semibold text-green-700 mb-2 text-sm">${field === 'wordOfWeek' ? 'Word of the Week' : field === 'keyIntention' ? 'Key Intention' : field === 'majorProject' ? 'Major Project or Goal' : 'One Thing to Let Go Of'}</label>
                            ${field.includes('Project') || field.includes('LetGo') ? `<textarea rows="2" data-field="${field}" class="w-full p-3 border-2 border-green-100 rounded focus:ring-2 focus:ring-red-500 focus:outline-none transition-colors resize-y" placeholder="Enter text">${getValue(field)}</textarea>` 
                            : `<input type="text" data-field="${field}" value="${getValue(field)}" placeholder="Enter text" class="w-full p-3 border-2 border-green-100 rounded focus:ring-2 focus:ring-red-500 focus:outline-none transition-colors">`}
                        </div>
                    `).join('')}
                </div>
            </section>

            <!-- Daily Planner -->
            <section class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">
                ${days.map((day,i) => `
                    <div class="bg-white rounded-lg overflow-hidden shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all p-4 ${i===todayIndex ? 'border-4 border-green-500' : ''}">
                        <div class="bg-gradient-to-r from-red-500 to-green-700 text-white p-2 font-bold text-xl mb-2">${day}</div>
                        <input type="text" data-field="day${i}Focus" value="${getValue(`day${i}Focus`)}" placeholder="Focus of the Day" class="w-full p-2 border rounded mb-2 focus:ring-2 focus:ring-green-500 focus:outline-none">
                        ${[1,2,3].map(n => `<input type="text" data-field="day${i}Priority${n}" value="${getValue(`day${i}Priority${n}`)}" placeholder="Priority ${n}" class="w-full p-2 border rounded mb-2 focus:ring-2 focus:ring-green-500 focus:outline-none">`).join('')}
                        <input type="text" data-field="day${i}Ritual" value="${getValue(`day${i}Ritual`)}" placeholder="Ritual / Restorative Practice" class="w-full p-2 border rounded mb-2 focus:ring-2 focus:ring-green-500 focus:outline-none">
                        <textarea data-field="day${i}Notes" placeholder="Notes & Reflections" class="w-full p-2 border rounded resize-y mb-2 focus:ring-2 focus:ring-green-500 focus:outline-none">${getValue(`day${i}Notes`)}</textarea>
                    </div>
                `).join('')}
            </section>

            <!-- Week-End Reflection -->
            <section class="bg-white border-l-8 border-green-700 rounded-lg p-8 mb-10 shadow-lg">
                <h2 class="text-2xl font-bold text-green-700 mb-5 flex items-center gap-2"><span>‚óÜ</span> Week-End Reflection</h2>
                ${['wentWell','feltFree','redesign','careForward'].map(field => `
                    <div class="mb-4">
                        <label class="block font-semibold text-gray-900 mb-2 text-sm">${field==='wentWell' ? 'What Went Well?' : field==='feltFree' ? 'Where Did You Feel Most Free?' : field==='redesign' ? 'What Needs Re-design?' : 'One Small Act of Care to Carry Forward'}</label>
                        <textarea rows="3" data-field="${field}" class="w-full p-3 border-2 border-green-100 rounded focus:ring-2 focus:ring-green-700 focus:outline-none transition-colors resize-y" placeholder="Enter text">${getValue(field)}</textarea>
                    </div>
                `).join('')}
            </section>

            <!-- Action Buttons -->
            <div class="no-print flex flex-wrap gap-3 justify-center mb-10">
                <button id="downloadBtn" class="px-6 py-3 bg-gradient-to-r from-red-500 to-red-700 text-white font-semibold rounded uppercase tracking-wide hover:shadow-lg transition-all hover:-translate-y-1">üíæ Download Plan</button>
                <button id="loadBtn" class="px-6 py-3 bg-gradient-to-r from-green-700 to-gray-900 text-white font-semibold rounded uppercase tracking-wide hover:shadow-lg transition-all hover:-translate-y-1">üìÇ Load Plan</button>
                <button id="printBtn" class="px-6 py-3 bg-gray-900 text-white font-semibold rounded uppercase tracking-wide hover:bg-gray-800 transition-all">üìÑ Print to PDF</button>
                <button id="clearBtn" class="px-6 py-3 bg-green-100 text-green-700 font-semibold rounded uppercase tracking-wide hover:bg-green-700 hover:text-white transition-all">üóëÔ∏è Clear All</button>
            </div>
        </div>
    `;
}

function render() {
    const app = document.getElementById('app');
    app.innerHTML = state.showWelcome ? renderWelcome() : renderPlanner();

    if (state.showWelcome) {
        document.getElementById('beginBtn').addEventListener('click', () => updateState({ showWelcome: false }));
    } else {
        document.getElementById('downloadBtn').addEventListener('click', downloadPlanner);
        document.getElementById('loadBtn').addEventListener('click', () => document.getElementById('fileInput').click());
        document.getElementById('printBtn').addEventListener('click', printPlanner);
        document.getElementById('clearBtn').addEventListener('click', clearPlanner);

        app.querySelectorAll('input, textarea').forEach(input => {
            const field = input.dataset.field;
            if (field) input.addEventListener('input', e => handleInputChange(field, e.target.value));
        });
    }
}

document.getElementById('fileInput').addEventListener('change', e => {
    if (e.target.files[0]) loadPlanner(e.target.files[0]);
    e.target.value = '';
});

render();
</script>
</body>
</html>
